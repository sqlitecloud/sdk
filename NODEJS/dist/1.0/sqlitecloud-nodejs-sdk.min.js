/*! For license information please see sqlitecloud-nodejs-sdk.min.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("tls"),require("net"),require("lz4")):"function"==typeof define&&define.amd?define(["tls","net","lz4"],e):"object"==typeof exports?exports.SQLiteCloud=e(require("tls"),require("net"),require("lz4")):t.SQLiteCloud=e(t.tls,t.net,t.lz4)}(this,((t,e,s)=>(()=>{var r={763:(t,e,s)=>{t.exports=s(774).default},774:(t,e,s)=>{"use strict";s.d(e,{default:()=>l});const r=s(535);var n=s(548),i=s(43);const a=(t="SQLiteCloud",e)=>{const s=new Date,r=`0 ${s.getDate()}`.slice(-2),n=`0${s.getMonth()+1}`.slice(-2),i=`${s.getFullYear()}/${n}/${r} ${s.getHours()}:${s.getMinutes()}:${s.getSeconds()}:${s.getMilliseconds()}`;console.log(`!!!!!!!!! ${t}: ${i} - ${e}`)},o=t=>":"!=t&&","!=t&&"_"!=t,d=t=>parseInt(t.subarray(1,t.indexOf(" ")).toString("utf8")),u=t=>{var e=t.indexOf(" ");t=t.subarray(e+1,t.length);var s=parseInt(t.subarray(0,t.indexOf(" ")+1).toString("utf8"));t=t.subarray(t.indexOf(" ")+1,t.length);var r=parseInt(t.subarray(0,t.indexOf(" ")+1).toString("utf8")),n=(t=t.subarray(t.indexOf(" ")+1,t.length)).subarray(0,1).toString("utf8"),a=Buffer.alloc(r),o=i.decodeBlock(t.subarray(t.length-s,t.length),a);if(t=Buffer.concat([t.subarray(0,t.length-s),a]),o<=0||o!==r)throw new Error(`lz4 uncompression error error at offset ${o}`);return{buffer:t,dataType:n}},c=t=>{var e,s=Array.isArray(t)?t[0].subarray(0,1).toString("utf8"):t.subarray(0,1).toString("utf8"),r=t.indexOf(" ");if("%"===s){if(Array.isArray(t))for(var n=0;n<t.length;n++){const e=u(t[n]);t[n]=e.buffer,s=e.dataType}else{const e=u(t);t=e.buffer,s=e.dataType}r=t.indexOf(" ")}switch(s){case":":e=parseInt(t.subarray(1,t.length-1).toString("utf8"));break;case",":e=parseFloat(t.subarray(1,t.length-1).toString("utf8"));break;case"_":e=null;break;case"+":case"^":e=t.subarray(r+1,t.length).toString("utf8");break;case"!":e=t.subarray(r+1,t.length-1).toString("utf8");break;case"#":e=JSON.parse(t.subarray(r+1,t.length).toString("utf8"));break;case"$":e=t.subarray(r+1,t.length);break;case"-":const u=t.subarray(r+1,t.length);var i=u.subarray(0,u.indexOf(" ")),a="0",l="-1";-1!==i.indexOf(":")&&(-1!==(a=i.subarray(i.indexOf(":")+1,i.length)).indexOf(":")&&(l=a.subarray(a.indexOf(":")+1,a.length).toString("utf8"),a=a.subarray(0,a.indexOf(":"))),a=a.toString("utf8"),i=i.subarray(0,i.indexOf(":")).toString("utf8"));const w=u.subarray(u.indexOf(" ")+1,u.length).toString("utf8");var f=new Error(w);throw f.code=parseInt(i),f.extErrCode=parseInt(a),f.offsetCode=parseInt(l),f;case"=":const C=t.subarray(r+1,t.length),v=parseInt(C.subarray(0,r-2).toString("utf8"));var g=C.subarray(C.indexOf(" ")+1,C.length);if(e=[],v>0)for(n=0;n<v;n++){const t=g.subarray(0,1).toString("utf8");if(o(t)){const t=d(g);e.push(c(g.subarray(0,g.indexOf(" ")+1+t))),g=g.subarray(g.indexOf(" ")+1+t,g.length)}else e.push(c(g.subarray(0,g.indexOf(" ")))),g=g.subarray(g.indexOf(" ")+1,g.length)}break;case"*":var b=t.subarray(r+1,t.length),y=parseInt(b.subarray(b.indexOf(":")+1,b.indexOf(" ")+1).toString("utf8"));b=b.subarray(b.indexOf(" ")+1,b.length);var m=parseInt(b.subarray(0,b.indexOf(" ")+1).toString("utf8"));b=b.subarray(b.indexOf(" ")+1,b.length);var p=parseInt(b.subarray(0,b.indexOf(" ")+1).toString("utf8"));b=b.subarray(b.indexOf(" ")+1,b.length);var O=[];for(n=0;n<p;n++){b.subarray(0,1).toString("utf8");const t=d(b);O.push(c(b.subarray(0,b.indexOf(" ")+1+t))),b=b.subarray(b.indexOf(" ")+1+t,b.length)}for(var S=[],x=0;x<m*p;x++){const t=b.subarray(0,1).toString("utf8");if(o(t)){const t=d(b);S.push(b.subarray(0,b.indexOf(" ")+1+t)),b=b.subarray(b.indexOf(" ")+1+t,b.length)}else S.push(b.subarray(0,b.indexOf(" "))),b=b.subarray(b.indexOf(" ")+1,b.length)}e=new h({version:y,nRows:m,nCols:p,colsName:O,data:S});break;case"/":for(m=0,p=0,O=[],S=[],n=0;n<t.length;n++){r=(b=t[n]).indexOf(" ");b=b.subarray(r+1,b.length);var T=parseInt(b.subarray(0,b.indexOf(" ")).toString("utf8"));y=parseInt(b.subarray(b.indexOf(":")+1,b.indexOf(" ")).toString("utf8")),b=b.subarray(b.indexOf(" ")+1,b.length);var I=parseInt(b.subarray(0,b.indexOf(" ")+1).toString("utf8"));if(m+=I,b=b.subarray(b.indexOf(" ")+1,b.length),p=parseInt(b.subarray(0,b.indexOf(" ")+1).toString("utf8")),b=b.subarray(b.indexOf(" ")+1,b.length),1===T)for(x=0;x<p;x++){b.subarray(0,1).toString("utf8");const t=d(b);O.push(c(b.subarray(0,b.indexOf(" ")+1+t))),b=b.subarray(b.indexOf(" ")+1+t,b.length)}for(var E=0;E<I*p;E++){const t=b.subarray(0,1).toString("utf8");if(o(t)){const t=d(b);S.push(b.subarray(0,b.indexOf(" ")+1+t)),b=b.subarray(b.indexOf(" ")+1+t,b.length)}else S.push(b.subarray(0,b.indexOf(" "))),b=b.subarray(b.indexOf(" ")+1,b.length)}}return new h({version:y,nRows:m,nCols:p,colsName:O,data:S});default:throw e=`Data type${s} is not defined in SCSP`,console.log(`Data type${s} is not defined in SCSP`),new TypeError(`Data type${s} is not defined in SCSP`)}return e};class h{#t=[];version;nRows=0;nCols=0;colsName=[];constructor(t){this.#t=t.data,this.version=t.version,this.nRows=t.nRows,this.nCols=t.nCols,this.colsName=t.colsName}get version(){return this.version}get nRows(){return this.nRows}get nCols(){return this.nCols}#e(t,e){return!(t>=this.nRows||e>=this.nCols)}getItem(t,e){if(this.#e(t,e)){const s=this.#t[t*this.nCols+e];return c(s)}throw new RangeError(`row value has to be less than ${this.nRows} and col value has to be less than ${this.nCols}`)}dump(){for(var t=[],e=0;e<this.nRows;e++){for(var s="| ",r=0;r<this.nCols;r++)s=s+this.getItem(e,r)+" | ";t.push(s)}return t}}class l{#s=null;#r="";#n=null;#i=null;#a={};#o={};#d=null;#u=null;#c=null;#h=3e5;#l=!1;constructor(t,e=!1){this.#l=e,this.#r=t.clientId,this.#a=!!t.disableTLS&&t.disableTLS,t.connectionString||(this.#n=t.host,this.#i=t.port,this.#o=t.tlsOptions?t.tlsOptions:{},this.#d=t.user,this.#u=t.password,this.#c=`AUTH USER ${this.#d} ${t.passwordHashed?"HASH":"PASSWORD"} ${this.#u};`,t.database&&(t.dbCreate&&!t.dbMemory&&(this.#c+=`CREATE DATABASE ${t.database} IF NOT EXISTS;`),this.#c+=`USE DATABASE ${t.database};`),t.sqliteMode&&(this.#c+="SET CLIENT KEY SQLITE TO 1;"),t.compression&&(this.#c+="SET CLIENT KEY COMPRESSION TO 1;"),t.zeroText&&(this.#c+="SET CLIENT KEY ZEROTEXT TO 1;"),t.nonlinearizable&&(this.#c+="SET CLIENT KEY NONLINEARIZABLE TO 1;"),t.noBlob&&(this.#c+="SET CLIENT KEY NOBLOB TO 1;"),t.maxData&&(this.#c+=`SET CLIENT KEY MAXDATA TO ${maxData};`),t.maxRows&&(this.#c+=`SET CLIENT KEY MAXROWS TO ${maxRows};`),t.maxRowset&&(this.#c+=`SET CLIENT KEY MAXROWSET TO ${maxRowset};`)),t.queryTimeout&&(this.#h=t.queryTimeout)}#f(t){return`+${Buffer.byteLength(t,"utf-8")} ${t}`}#g(t,e){return t.length-t.indexOf(" ")-1==e}connect(){return new Promise(((t,e)=>{if(!this.#d||!this.#u){var s=new TypeError('The "config.user" or "config.password" argument must be specified');s.code="ERR_MISSING_ARGS",e(s)}var i,o;this.#h&&("number"!=typeof this.#h?(i=new TypeError('The "config.queryTimeout" must be one of type number. Received '+typeof this.#h)).code="ERR_INVALID_ARG_TYPE":this.#h<0&&((i=new RangeError('The "config.queryTimeout" must be greater then 0. Received '+this.#h)).code="ERR_INVALID_ARG_RANGE"),i&&e(i));o=this.#a?new n.connect(this.#i,this.#n,this.#o,(async()=>{this.#l&&a(this.#r,"connection created"),this.#l&&a(this.#r,"sending init commands: "+this.#c);try{this.#s=o;const e=await this.sendCommands(this.#c);t(e)}catch(t){a(this.#r,"initCommandsResponse error"),e(t)}})).on("close",(()=>{this.#l&&a(this.#r,"connection closed")})).on("end",(()=>{this.#l&&a(this.#r,"end connection")})).once("error",(t=>{this.#l&&a(this.#r,"received error"),this.#l&&console.log(t),o.destroy(),e(new Error("Connection on error event",{cause:t}))})):new r.connect(this.#i,this.#n,this.#o,(async()=>{if(o.authorized){this.#l&&a(this.#r,"connection authorized"),this.#l&&a(this.#r,"sending init commands: "+this.#c);try{this.#s=o;const e=await this.sendCommands(this.#c);t(e)}catch(t){a(this.#r,"initCommandsResponse error"),e(t)}}else this.#l&&a(this.#r,"connection NOT authorized"),e(new Error("Connection NOT authorized",{cause:o.authorizationError}))})).on("close",(()=>{this.#l&&a(this.#r,"connection closed")})).on("end",(()=>{this.#l&&a(this.#r,"end connection")})).once("error",(t=>{this.#l&&a(this.#r,"received error"),this.#l&&console.log(t),o.destroy(),e(new Error("Connection on error event",{cause:t}))}))}))}sendCommands(t){t=this.#f(t);var e=Buffer.alloc(0),s=[];return this.#l&&a(this.#r,"recevied new command to be sent: "+t),new Promise(((r,n)=>{var i;const u=t=>{this.#l&&a(this.#r,"onData event: "+t);const h=0===e.length?t.subarray(0,1).toString("utf8"):e.subarray(0,1).toString("utf8");e=Buffer.concat([e,t]);const l=o(h);if(this.#l&&a(this.#r,"New data has command LEN? "+l),l){var f;if(f=d(e),this.#l&&a(this.#r,"Reading new data with LEN: "+f),"%"===h)var g=e.subarray(e.indexOf(" ")+1,e.length),b=(g=(g=g.subarray(g.indexOf(" ")+1,g.length)).subarray(g.indexOf(" ")+1,g.length)).subarray(0,1).toString("utf8");if(this.#g(e,f))if("/"!==h&&"/"!==b){this.#s.off("data",u),clearTimeout(i);try{const t=c(e);r(t)}catch(t){n(t)}}else if("0 0 0 "===t.subarray(t.indexOf(" ")+1,t.length).toString("utf8")){clearTimeout(i);try{const t=c(s);r(t)}catch(t){n(t)}}else s.push(e),e=Buffer.alloc(0),this.#s.write(this.#f("OK"))}else{const t=e.subarray(e.length-1,e.length).toString("utf8");if(this.#l&&a(this.#r,"Reading new data without command LEN")," "==t){this.#l&&a(this.#r,"Reading complete, endining with space"),this.#s.off("data",u),clearTimeout(i);try{const t=c(e);r(t)}catch(t){n(t)}}}};this.#s.write(t,"utf8",(()=>{i=setTimeout((()=>{this.#s.off("data",u),clearTimeout(i),n(new Error("Request timed out",{cause:t}))}),this.#h),this.#s.on("data",u)})),this.#s.once("error",(t=>{this.#l&&a(this.#r,"received error"),this.#l&&console.log(t),client.destroy(),n(new Error("Connection on error event",{cause:t}))}))}))}disconnect(){return new Promise(((t,e)=>{this.#s.end((()=>{this.#l&&a(this.#r,"closing connection"),t(`Closed connection for clientId ${this.#r}`)}))}))}}},43:t=>{"use strict";t.exports=s},548:t=>{"use strict";t.exports=e},535:e=>{"use strict";e.exports=t}},n={};function i(t){var e=n[t];if(void 0!==e)return e.exports;var s=n[t]={exports:{}};return r[t](s,s.exports,i),s.exports}return i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i(763)})()));
//# sourceMappingURL=sqlitecloud-nodejs-sdk.min.js.map